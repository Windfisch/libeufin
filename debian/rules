#!/usr/bin/make -f
include /usr/share/dpkg/default.mk

export JAVA_HOME = /usr/lib/jvm/default-java
LIBEUFIN_HOME = /usr/share/libeufin
DEV = -dev.2
FULLVER = $(DEB_VERSION_UPSTREAM)$(DEV)

clean:
	rm -rf libeufin-$(FULLVER)
build: build-arch build-indep
build-arch:
	true
build-indep:
	true
override_dh_auto_install:
	unzip build/distributions/libeufin-$(FULLVER).zip
	dh_install libeufin-$(FULLVER)/lib/nexus-$(FULLVER)-all.jar $(LIBEUFIN_HOME)/lib
	dh_install libeufin-$(FULLVER)/lib/sandbox-$(FULLVER)-all.jar $(LIBEUFIN_HOME)/lib
	install -D -m755 libeufin-$(FULLVER)/bin/libeufin-cli debian/libeufin/$(LIBEUFIN_HOME)/bin/libeufin-cli
	install -D -m755 libeufin-$(FULLVER)/bin/libeufin-nexus debian/libeufin/$(LIBEUFIN_HOME)/bin/libeufin-nexus
	install -D -m755 libeufin-$(FULLVER)/bin/libeufin-sandbox debian/libeufin/$(LIBEUFIN_HOME)/bin/libeufin-sandbox
	dh_link $(LIBEUFIN_HOME)/bin/libeufin-cli /usr/bin/libeufin-cli
	dh_link $(LIBEUFIN_HOME)/bin/libeufin-nexus /usr/bin/libeufin-nexus
	dh_link $(LIBEUFIN_HOME)/bin/libeufin-sandbox /usr/bin/libeufin-sandbox
	dh_install debian/libeufinenv.conf /etc/libeufin
	dh_install debian/sandbox.service /etc/systemd/system
	dh_install debian/nexus.service /etc/systemd/system

binary:
	dh $@
binary-arch:
	dh $@
binary-indep:
	dh $@

# Override this step because it's very slow and likely
# unnecessary for us.
override_dh_strip_nondeterminism:
	true

get-orig-source:
	uscan --force-download --rename
